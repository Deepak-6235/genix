// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Language {
  id        String   @id @default(cuid())
  code      String   @unique // 'en', 'ar', 'pt', 'zh', 'ja', 'de', 'fr'
  name      String   // 'English', 'Arabic', 'Portuguese', etc.
  dir       String   @default("ltr") // 'ltr' or 'rtl'
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  services      Service[]      @relation("ServiceLanguage")
  blogs         Blog[]         @relation("BlogLanguage")
  detailedBlogs DetailedBlog[] @relation("DetailedBlogLanguage")
  faqs          FAQ[]          @relation("FAQLanguage")
  reviews       Review[]       @relation("ReviewLanguage")
  comments      Comment[]      @relation("CommentLanguage")

  @@map("languages")
}

model Admin {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admins")
}

model Service {
  id                    String   @id @default(cuid())
  slug                  String
  languageId            String   // Foreign key to Language table
  language              Language @relation("ServiceLanguage", fields: [languageId], references: [id])

  // Content fields
  name                  String
  shortDescription      String   @db.Text
  title                 String
  subtitle              String
  fullDescription       String?  @db.Text
  imageUrl              String?  // S3 image URL

  // Meta
  isActive              Boolean  @default(true)
  order                 Int      @default(0)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  // Unique constraint: same slug can have multiple languages
  @@unique([slug, languageId], name: "slug_languageId")
  @@map("services")
}

model Blog {
  id                    String   @id @default(cuid())
  slug                  String
  languageId            String   // Foreign key to Language table
  language              Language @relation("BlogLanguage", fields: [languageId], references: [id])

  // Content fields
  name                  String
  shortDescription      String
  author                String
  imageUrl              String
  publishedAt           DateTime?

  // Meta
  isActive              Boolean  @default(true)
  order                 Int      @default(0)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  // Relations
  detailedBlogs         DetailedBlog[] @relation("BlogDetails")

  // Unique constraint: same slug can have multiple languages
  @@unique([slug, languageId], name: "slug_languageId")
  @@map("blogs")
}

model DetailedBlog {
  id          String   @id @default(cuid())
  blogId      String   // Foreign key to Blog table
  blog        Blog     @relation("BlogDetails", fields: [blogId], references: [id], onDelete: Cascade)
  languageId  String   // Foreign key to Language table
  language    Language @relation("DetailedBlogLanguage", fields: [languageId], references: [id])

  // Content fields - multiple title+description sections for each blog
  title       String   @db.Text
  description String   @db.Text
  imageUrl    String?  // Optional image for this section

  // Meta
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Unique constraint: each detailed blog section must be unique per blog, language, and order
  @@unique([blogId, languageId, order], name: "blog_language_order")
  @@map("detailed_blogs")
}

model Statistic {
  id        String   @id @default(cuid())
  key       String   @unique // e.g., "satisfied_customers", "work_team", "houses", "years_experience"
  value     Int      // e.g., 1000, 50, 1000, 12
  suffix    String?  // e.g., "+", "K", etc.
  icon      String?  // Icon emoji or name
  color     String?  // Card background color (e.g., "blue", "green", "purple", "cyan")
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("statistics")
}

model AboutUs {
  id              String   @id @default(cuid())
  email           String?
  phoneNumber1    String?  // First phone number
  phoneNumber2    String?  // Second phone number
  workingHours    String?  // e.g., "24/7"
  address         String?  // Full address
  city            String?  // City name
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("about_us")
}

model Review {
  id          String   @id @default(cuid())
  slug        String
  languageId  String   // Foreign key to Language table
  language    Language @relation("ReviewLanguage", fields: [languageId], references: [id])

  // Content fields
  name        String   // Customer name (e.g., "Ahmed Al-Maliki")
  position    String   // Job title (e.g., "Facilities Manager")
  company     String   // Company name (e.g., "Elite Trading Company")
  text        String   @db.Text // Review text
  rating      Int      @default(5) // Star rating (1-5)

  // Meta
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Unique constraint: same slug can have multiple languages
  @@unique([slug, languageId], name: "slug_languageId")
  @@map("reviews")
}

model FAQ {
  id          String   @id @default(cuid())
  faqId       String?  // Unique identifier for the same FAQ across all languages (optional for migration)
  languageId  String   // Foreign key to Language table
  language    Language @relation("FAQLanguage", fields: [languageId], references: [id])

  // Content fields
  question    String   @db.Text
  answer      String?  @db.Text // Nullable - can be empty for unanswered questions

  // Meta
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("faqs")
}

model Comment {
  id          String   @id @default(cuid())
  commentId   String   // Unique identifier for the same comment across all languages
  blogSlug    String   // The blog slug this comment belongs to
  languageId  String   // Foreign key to Language table
  language    Language @relation("CommentLanguage", fields: [languageId], references: [id])

  // User fields
  name        String
  email       String
  website     String?

  // Content (translated)
  comment     String   @db.Text

  // Meta
  isApproved  Boolean  @default(false) // Admin can approve comments
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([commentId, languageId], name: "commentId_languageId")
  @@index([blogSlug])
  @@map("comments")
}
